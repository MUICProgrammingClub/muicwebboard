<h1>All Lectures</h1>

<table class="table table-striped">
  <thead>
    <tr>
      <th>Share by</th>
      <th >Course</th>
      <th >Instructor</th>
      <th >Term</th>
      <th >Lecture name</th>
      <th >Chapter</th>
      <th > Average rating </th>
      <th colspan="2"> Option </th>
    </tr>
  </thead>

  <tbody>
    <% @lectures.each do |lecture| %>
      <tr>
        <td><%= lecture.user.first_name%></td>
        <td><%= lecture.course.course_name%></td>
        <td><%= lecture.instructor.first_name %></td>
        <td><%= lecture.term.term_formatted %></td>
        <td><%= link_to lecture.lecture_name, lecture %></td>
        <td><%= lecture.chapter %></td>
        <td>
          <% total = 0 %>
          <% n = 0 %>
          <% lecture.reviews.each do |review| %>
            <% if !review.rating.nil? %>
              <% total += review.rating %>
              <% n += 1 %>
            <% end %>
          <% end %>
          <% if total != 0 %>
         
          <% (1..5).each do |i| %>
                <% if i <= total/n %>
                  <span class="glyphicon glyphicon-star"></span>
                <% else %>
                  <span class= "glyphicon glyphicon-star-empty"></span>
                <% end %> 
          <% end %>
          <% else %>
            There are currently no review 
          <% end %>
        </td>
         <% if current_user == lecture.user %> 
        <td><%= link_to 'Edit', edit_lecture_path(lecture) %></td>
        <td><%= link_to 'Remove', lecture, method: :delete, data: { confirm: 'Are you sure?' } %></td>
        <% else %>
        <td></td>
        <td></td>
        <% end %>
      </tr>
    <% end %>
  </tbody>
</table>

<br>
<% if user_signed_in? %>
<%= link_to 'New Lecture', new_lecture_path, :class => 'btn btn-default' %>
<% else %>
<p> Please sign in before making new lectures </p>
<% end %> 